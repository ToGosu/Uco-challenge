
server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: uco-challenge
  
  # Configuración de Base de Datos (desde Vault o properties con valores por defecto)
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/ucochallenge}
    username: ${DATABASE_USERNAME:postgres}
    password: 'C2wvVCP18#6@'
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
  
  # Vault Configuration
  cloud:
    vault:
      enabled: ${VAULT_ENABLED:false}
      uri: ${VAULT_URI:http://localhost:8200}
      token: ${VAULT_TOKEN:root}
      authentication: TOKEN
      kv:
        enabled: true
        backend: secret
        default-context: ${spring.application.name}
      fail-fast: false
    # Spring Cloud Compatibility
    compatibility-verifier:
      enabled: false
  
  config:
    import: optional:vault://
  
  # Security OAuth2 (desde Vault)
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${auth0.issuer-uri:https://dev-l7bs34cafn0six34.us.auth0.com/}
          audience: ${auth0.audience:https://ucochallenge-api/}

# Auth0 Configuration (para Auth0Properties)
auth0:
  issuer-uri: ${AUTH0_ISSUER_URI:https://dev-l7bs34cafn0six34.us.auth0.com/}
  audience: ${AUTH0_AUDIENCE:https://ucochallenge-api/}

# API Gateway Configuration
api:
  gateway:
    base-url: ${API_GATEWAY_URL:http://localhost:8090}
    enabled: ${API_GATEWAY_ENABLED:true}

# NotificationAPI (desde Vault o properties)
notificationapi:
  base-url: ${NOTIFICATIONAPI_BASE_URL:https://api.notificationapi.com}
  client-id: ${NOTIFICATIONAPI_CLIENT_ID:71ys9hvevyqib7ecozhprd0sr1}
  client-secret: ${NOTIFICATIONAPI_CLIENT_SECRET:6u2xwg1knmb07rvgttj8mj50e4ut41tjv6p7qhuxkreep0skkumb0eo902}

# Notification Catalog Service (a través del API Gateway)
# Nota: Si api.gateway.base-url no está definido, usa el valor directo
notification:
  catalog:
    url: ${NOTIFICATION_CATALOG_URL:http://localhost:8090/catalog}
  
# Parameters Service (a través del API Gateway)
parameters:
  service:
    url: ${PARAMETERS_SERVICE_URL:http://localhost:8090/catalog/api/v1/parameters}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,vault,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
  tracing:
    sampling:
      probability: 1.0

# Logging
logging:
  level:
    root: INFO
    co.edu.uco.ucochallenge: DEBUG
    org.springframework.vault: DEBUG
    org.springframework.security: DEBUG
    io.opentelemetry: INFO

# OpenTelemetry Configuration
otel:
  service:
    name: ${spring.application.name}
    version: 0.0.1-SNAPSHOT
  exporter:
    otlp:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4317}
      protocol: ${OTEL_EXPORTER_OTLP_PROTOCOL:grpc}

---
# Profile: Docker
spring:
  config:
    activate:
      on-profile: docker
  
  cloud:
    vault:
      enabled: ${VAULT_ENABLED:true}
      uri: http://vault:8200
      token: root
  
  datasource:
    url: jdbc:postgresql://db:5432/ucochallenge

# API Gateway en Docker (usando nombre del servicio)
api:
  gateway:
    base-url: ${API_GATEWAY_URL:https://nginx-waf:8443/api-gateway}

notification:
  catalog:
    url: ${NOTIFICATION_CATALOG_URL:https://nginx-waf:8443/catalog}

parameters:
  service:
    url: ${PARAMETERS_SERVICE_URL:https://nginx-waf:8443/catalog/api/v1/parameters}

---
# Profile: Production (Railway/Render)
spring:
  config:
    activate:
      on-profile: prod
  
  cloud:
    vault:
      enabled: ${VAULT_ENABLED:true}
      uri: ${VAULT_URI}
      authentication: APPROLE
      app-role:
        role-id: ${VAULT_ROLE_ID}
        secret-id: ${VAULT_SECRET_ID}
        role: my-app
        app-role-path: approle

# API Gateway en Producción
api:
  gateway:
    base-url: ${API_GATEWAY_URL}

notification:
  catalog:
    url: ${NOTIFICATION_CATALOG_URL:${api.gateway.base-url}/catalog}

parameters:
  service:
    url: ${PARAMETERS_SERVICE_URL:${api.gateway.base-url}/catalog/api/v1/parameters}
